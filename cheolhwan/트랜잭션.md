# DataBase - Transcation

## 1. 트랜잭션이란
- 데이터베이스의 상태를 변환시키는 하나의 논리적인 작업 단위

## 2. 트랜잭션의 성질(ACID)
- 원자성(Atomicity)
    - 트랜잭션의 작업이 부분적으로 실행되거나 중단 될 수 없다.
    - 트랜잭션의 모든 연산들은 정상적으로 수행 완료되거나 아니면 전혀 어떠한 연산도 수행되지 않은 상태를 보장해야 한다. (All or Nothing)
- 일관성(Consistency)
    - 트랜잭션 완료 후 일관적인 DB 상태를 유지한다.
        - ex) 데이터 타입이 정수 &rarr; 문자열이 될 수 없음.
- 독립성(Isolation)
    - 하나의 트랜잭션이 실행하는 도중에 변경한 데이터는 이 트랜잭션이 완료될 때까지 다른 트랜잭션이 참조하지 못한다.
    - 즉, 트랜잭션 끼리는 서로 간섭할 수 없다.
- 지속성(Durability)
    - 성공적으로 수행된 트랜잭션은 영원히 반영이 된다.
    - commit을 하게 되면 현재 상태는 영원히 보장된다.

### 2-1. 원자성을 보장하는 방법
- 현재 수행중인 트랜잭션에 의해 변경된 내용을 유지하면서, 이전에 commit된 상태를 임시 영역에 따로 저장함으로써 보장한다.
- 즉, 현재 수행하는 트랜잭션에서 오류가 발생하게 되면, 임시 영역에 저장한 데이터로 rollback을 하게 된다.

### 2-2. 일관성 보장
- 트랜잭션 수행 전, 후 데이터의 모델의 제약 조건을 만족하는 것으로 보장한다.
- 제약조건 : 기본키, 외래키, 도메인, 도메인 제약조건 등...

### 2-3. 독립성 보장
- 병행 처리 :
    - 트랜젹션에 정해진 시간을 할당하여 작업을 하고, 정해진 시간 종료 후 다른 트랙잭션을 실행하는 방식으로 트랜잭션을 처리한다.
    - 이런 경우, 공통된 데이터를 조작하게 되며, 데이터가 혼란스러워 질 수 있음.
- OS의 Semaphore와 비슷한 개념으로 lock & excute unlock을 통해 고립성을 보장한다.
- 즉, 데이터를 읽거나 쓸 때는 다른 트랜잭션이 접근하지 못하도록 lock을 걸어 고립성을 보장하고, 수행이 종료 된 후 unlock을 통해 다른 트랜잭션이 접근 할 수 있도록 한다.
- 단, 이과정에서 deadlock이 발생 할 수 있음
- 2PL 프로토콜(2 Phase Lock Protocol)
    - 2PL 프로토콜이란 여러 트랜잭션이 공유하고 있는 데이터에 동시에 접근할 수 없도록 하기위한 목적을 가진 프로토콜
    - growing phase(상승단계): read_lock , write_lock
    - shrinking phase(하강단계) : unlock
    - 상승과 하강 단계는 섞일 수 없음 &rarr; lock과 unlock이 번갈아 수행되지 않고 lock이 수행 된 후 unlock이 수행되어야 한다.
    ![2pl protocol](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F9958D24B5A7D9F440F);
- 즉, 트랜잭션 처리 성능을 위해 병행 처리를 사용해야함 -> 이 과정에서 독립성을 보장하기 위하여 2PL 프로토콜을 사용한다.(deadlock이 발생하지 않기 위해)
- 보수적 locking ( conservative locking )
    - 트랜잭션이 시작되면 모든 lock을 얻는 방식으로서, 데드락이 발생하지 않지만 병행성이 좋지 못함
- 엄격한 locking ( strict locking )
    - 트랜잭션이 commit을 만날 때까지 lock을 갖고 있다가 commit을 만날때 unlock을 하는 방식으로 데드락이 발생하지만 병행성이 좋음
    - 일반적으로 병행성이 좋은 strict 방식을 사용




## 3. 트랜잭션 격리수준(Isolation Level)

### 3-1. 트랜잭션 격리 수준이란.

- 트랜잭션에서 일관서잉 없는 데이터를 허용하도록 하는 수준

### 3-2. 


### 참고자료 및 이미지 출처
- https://victorydntmd.tistory.com/129